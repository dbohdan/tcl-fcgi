<!-- manual page source format generated by RosettaMan v3.0.2a9, -->
<!-- available via anonymous ftp from ftp.cs.berkeley.edu:/ucb/people/phelps/tcltk/rman.tar.Z -->

<HTML>
<HEAD>
<TITLE>FCGI.TCL(TCL) manual page</TITLE>
</HEAD>
<BODY>
<A HREF="#toc">Table of Contents</A><P>
 
<H2><A NAME="sect0" HREF="#toc0">NAME </A></H2>
Fcgi.tcl - Tcl support for the FastCGI protocol  
<H2><A NAME="sect1" HREF="#toc1">DESCRIPTION </A></H2>
Fcgi.tcl 
allows Tcl programs to be used in FastCGI applications.  Fcgi.tcl requires 
Tcl version 8.0 and higher, and Extended Tcl (TclX) version 8.x and higher. 
 
<H2><A NAME="sect2" HREF="#toc2">SYNOPSIS </A></H2>
<P>
 package require Fcgi <BR>
 <P>
 FCGI_Accept <BR>
 FCGI_Finish <BR>
 FCGI_SetExitStatus 
n <BR>
 FCGI_StartFilterData <BR>
 FCGI_SetBufSize n <BR>
 <P>
  
<H2><A NAME="sect3" HREF="#toc3">INNVOCATION </A></H2>
FastCGI programs 
are started by an 'AppClass' directive from a web server  that supports 
FastCGI, or are started manually and accessed from a web server via the 
'ExternalAppClass' directive.  <P>
Fcgi.tcl comes in two flavors: a 100% Tcl version, 
and another which is a C extension.  Each fcgi.tcl flavor provides the same 
programming interface.  <P>
When a program using  the 100% Tcl flavor of Fcgi.tcl 
is started by 'AppClass', Fcgi.tcl assumes that file descriptor 0 is a socket 
that is used to accept new connections.  When using 'AppClass' style connections, 
Fcgi.tcl requires Extended Tcl (TclX).  <P>
If 'ExternalAppClass' is used, the 
FastCGI Tcl program must be started  manually.  In this case, Fcgi.tcl expects 
the command line argument <B>-port x</B> or the environment variable <B>PORT</B> to specify 
the port on which to listen for connection.  'ExternalAppClass' style connections 
do not require Extended Tcl (TclX).  <P>
Programs using the C extension flavor 
of Fcgi.tcl don't require TclX. Programs started as 'ExternalAppClass', must 
be started with 'driver.tcl' or similar program.  Driver.tcl requires Extended 
Tcl (TclX).  
<H2><A NAME="sect4" HREF="#toc4">COMMANDS </A></H2>

<DL>

<DT><B>FCGI_Accept </B>  </DT>
<DD> <BR>
Accept a new FastCGI connection.  FCGI_Accept 
returns "0" for a new connection, or "-1" if an error was encountered.  
 If the application was invoked as a CGI program, FCGI_Accept will return 
"0" for the first call to it, then return "-1" on subsequent calls.  This 
allows a properly coded FastCGI program to work in a convential CGI environment. 
FCGI_Accept sets environment variables to that of the initial enviroment 
plus variables for the FastCGI connection. FCGI_Accept will call FCGI_Finish 
if a previous response is still pending before accepting a new request. 
  Additionally, FCGI_Accept sets the environment variable  <I>FCGI_ROLE </I> 
to one of three values, depending of the type of the FastCGI connection: 
 <blockquote> <P>
</DD>

<DT>RESPONDER  </DT>
<DD> <BR>
The FastCGI program receives CGI/1.1 environment variables. 
 The FastCGI program will receive at most  <B>CONTENT_LENGTH</B> bytes of data 
on the Tcl channel <I>stdin </I>.   The FastCGI program should respond the the 
request as a typical CGI program by writing its output on the Tcl channel 
<I>stdout </I>.    <P>
</DD>

<DT>AUTHORIZER  </DT>
<DD> <BR>
The FastCGI program receives HTTP request information 
as environment variables. The FastCGI program will receive at most  <B>CONTENT_LENGTH</B> 
bytes of data on the Tcl channel <I>stdin </I>.   The FastCGI program should respond 
as status 200 to indicate access should be granted.  The FastCGI program 
may also send HTTP headers that are  prefixed with <I>Variable- </I> by writing 
on <I>stdout </I>.  <P>
</DD>

<DT>FILTER  </DT>
<DD> <BR>
The FastCGI program receives CGI/1.1 environment variables. 
 The FastCGI program will receive at most <B>CONTENT_LENGTH</B> bytes of data 
on the Tcl channel <I>stdin </I>.  After all of stdin has been read, the FastCGI 
program may call FCGI_StartFilterData to receive the additional data stream. 
 The FastCGI program will then receive at most <B>FCGI_DATA_LENGTH</B> bytes 
on the Tcl channel <I>stdin </I>. </DD>
</DL>
 </blockquote>
 <P>

<DL>

<DT><B>FCGI_Finish</B>  </DT>
<DD> <BR>
Finish a FastCGI connection 
by flushing output buffers and sending an exit status code.  If an exit 
code has not been set by calling  FCGI_SetExitStatus, FCGI_Finish assumes 
a code of "0".  <P>
</DD>

<DT><B>FCGI_SetExitStatus <I>status-code </I></B>  </DT>
<DD> <BR>
Set an exit code for the 
most current FastCGI connection.  The last call to FCGI_SetExitStatus sets 
the status code to be returned upon calling FCGI_Finish.  <I>status-code </I> should 
be a numeric integer.  <P>
</DD>

<DT><B>FCGI_StartFilterData</B>  </DT>
<DD> <BR>
Start receiving the  <B>FCGI_DATA</B> 
data stream as the Tcl channel <I>stdin </I>.  Any previous data left unread on 
the stdin stream will be lost.  FCGI_DATA is only received when the FastCGI 
application's role is FILTER.  <P>
</DD>

<DT><B>FCGI_SetBufSize <I>buffer-size </I></B>  </DT>
<DD> <BR>
Sets the size 
of the output buffer for Tcl  channels <I>stdout </I> and <I>stderr </I>.  The default 
buffer size for each channel is 4096 bytes.  A buffer size of "0" causes 
output to be flushed on every <I>puts </I> to stdout or stderr.  The maximum buffer 
size allowed is 65536 bytes.  <P>
FastCGI output may also be flushed at any 
time by calling the Tcl command <I>flush stdout </I>. </DD>
</DL>
 
<H2><A NAME="sect5" HREF="#toc5">FASTCGI PROTOCOL </A></H2>
Currently, 
the Fcgi.tcl package is single threaded, and replies to FastCGI managment 
records as:  <blockquote>
<DL>

<DT><B>FCGI_MAX_CONNS</B>  </DT>
<DD>"1" </DD>

<DT><B>FCGI_MAX_REQS</B>  </DT>
<DD>"1" </DD>

<DT><B>FCGI_MPXS_CONNS</B>  </DT>
<DD>"0" 
</DD>
</DL>
 </blockquote>
 
<H2><A NAME="sect6" HREF="#toc6">SEE ALSO </A></H2>
cgi.tcl, a Tcl package for writing CGI programs, by Don Libes. 
 <BR>
<A HREF="http://expect.nist.gov/cgi.tcl.">http://expect.nist.gov/cgi.tcl.</A>
  <P>
FastCGI documentation.  <BR>
<A HREF="http://www.fastcgi.com">http://www.fastcgi.com</A>
 
 <P>
Unoffical FastCGI page.    <BR>
<A HREF="http://fastcgi.idle.com">http://fastcgi.idle.com</A>
  
<H2><A NAME="sect7" HREF="#toc7">NOTES </A></H2>
See the files 
README, INSTALL and  NOTES for additional information and  Apache Server 
configuration.  Fcgi.tcl is an orginal implementation of the FastCGI protocol, 
version 1.0 dated Arpil 29, 1996 by Mark R. Brown,  Open Market, Inc.  Fcgi.tcl 
is compatiable with the libfcgi library  available with the FastCGI developer's 
kit for Tcl.  <P>
If cgi.tcl is used in the same application as Fcgi.tcl,  you 
should order <I>package require </I> commands as:  <P>
package require cgi <BR>
 package 
require Fcgi <BR>
  <P>
Cgi.tcl uses the global array <I>_cgi </I> to  hold state information. 
 FCGI_Accept will set the <I>_cgi </I> array to  beginning values so that its 
state information will be reset for each new connection.  
<H2><A NAME="sect8" HREF="#toc8">AUTHOR </A></H2>
Tom Poindexter, 
tpoindex@nyx.net, Talus Technologies, Inc., Highlands Ranch, CO. <A HREF="http://www.nyx.net/~tpoindex">http://www.nyx.net/~tpoindex</A>
 
 <P>
Copyright 1998 Tom Poindexter.  See the file 'LICENSE.TERMS' for  additional 
copyright and licensing terms. <P>

<HR><P>
<A NAME="toc"><B>Table of Contents</B></A><P>
<UL>
<LI><A NAME="toc0" HREF="#sect0">NAME</A></LI>
<LI><A NAME="toc1" HREF="#sect1">DESCRIPTION</A></LI>
<LI><A NAME="toc2" HREF="#sect2">SYNOPSIS</A></LI>
<LI><A NAME="toc3" HREF="#sect3">INNVOCATION</A></LI>
<LI><A NAME="toc4" HREF="#sect4">COMMANDS</A></LI>
<LI><A NAME="toc5" HREF="#sect5">FASTCGI PROTOCOL</A></LI>
<LI><A NAME="toc6" HREF="#sect6">SEE ALSO</A></LI>
<LI><A NAME="toc7" HREF="#sect7">NOTES</A></LI>
<LI><A NAME="toc8" HREF="#sect8">AUTHOR</A></LI>
</UL>
</BODY></HTML>
